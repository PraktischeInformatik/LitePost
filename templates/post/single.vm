$Resources.addScriptFooter("js/singlepost.js")

#macro(comments $comments)
  <ul> 
    #foreach($comment in $comments)
      <li>
        <p>$comment.text</p>
        <a href="javascript:answerComment($comment.getCommentId())">Antworten</a>
        #set($subComments = $comment.subComments)
        #comments($subComments)
      </li>
    #end
  </ul>  
#end

#parse("header.vm")
<style type="text/css">
  #images li{
    display: inline-block;
    vertical-align: top;
  }
  #images img {
    width: 100%;
    max-width: 300px;
    border: 1em solid #eee;
    
  }
  #images img:hover {
    border-color: #ddd;
  }
  #image-box {
    display: none;
    position: fixed;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    border: 1em transparent #eee;
    background: rgba(28, 28, 28, 0.7);
    background-repeat: no-repeat;
    background-size: contain;
    background-position: center center;
    transition: opacity 0.3s;
    pointer-events: none;
  }
  #image-box.show {
    display: block;
    opacity: 0;
  }
  #image-box.full {
    opacity: 1;
    pointer-events: all;
  }
</style>
<div id="wrapper">
  	<div id="main"> 
      <h2>$post.title</h2>
      <p>$post.text</p>
      #if($post.event)
        <i>$post.eventDate</i>
      #end
      <ul id="images">
        <div id="image-box" onclick="hide_image()"></div>
        #foreach($image in $post.images)
          <li><img onclick="enlarge_image(this)" src="$image.source"></li>
        #end
      </ul>
      <small>$post.contact</small>
      $Form.begin("POST", ${Router.linkTo("commentPost", $post.postId)})
        #if($Validator.error("hasContent")) 
          <p>Bitte geben sie einen Kommentar ein</p>  
        #end
        #if($Validator.error("validCsrfToken")) 
          <p>validCsrfToken</p>  
        #end
        #if($Validator.error("postIdNumeric")) 
          <p>postIdNumeric</p>  
        #end
        #if($Validator.error("parentIdNumericOrEmpty")) 
          <p>parentIdNumericOrEmpty</p>  
        #end
        $Input.hidden.name("parent_id").value("0").id("parentId")
        $Input.textarea.name("content").placeholder("Kommentar").prepopulate()
        $Input.csrfToken
        $Input.submit.general.small.value("Kommentieren")
      $Form.end()
      <h3>Kommentare</h3>
      #comments($post.comments)
    </div>
  #parse("sidebar.vm")
  </div>
</div>

<script type="text/javascript">

function answerComment(comment_id) {
  var parentId = document.getElementById("parentId");
  parentId.value = comment_id;
}

</script>
#parse("footer.vm")
